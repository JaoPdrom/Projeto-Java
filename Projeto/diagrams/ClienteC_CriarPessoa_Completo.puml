@startuml
title Fluxo Completo - ClienteC (CriarPessoa e métodos envolvidos)

'=====================================
' Seção 1: CriarPessoa (Fluxo principal)
'=====================================
start
:Read UI fields (documento, nome, email, ativo);

if (documento empty?) then (yes)
  :Exception "Documento obrigatório";
  stop
endif

if (nome empty?) then (yes)
  :Exception "Nome obrigatório";
  stop
endif

:tipoPessoa = obterTipoPessoaSelecionada();
if (tipoPessoa == null) then (yes)
  :Exception "Tipo de pessoa obrigatório";
  stop
endif

:endereco = montarEnderecoAtual();

if (txtTelNumero filled?) then (yes)
  :Create TelefoneVO (codPais, ddd, numero, cpf);
else
  :tel = null;
endif

:Build PessoaVO (cpf, nome, email, ativo, tipoPessoa);
:Add endereço to list;

if (tel != null) then (yes)
  :Add telefone to list;
endif

:PessoaRN.adicionarPessoa(pessoa);
:Create ClienteVO (cpf);

if (dtpDataCadastro != null) then (yes)
  :cliente.cli_dtCadastro = dtpDataCadastro;
endif

:ClienteRN.salvarNovo(cliente, null, null);
stop


'=====================================
' Seção 2: obterTipoPessoaSelecionada()
'=====================================
partition "obterTipoPessoaSelecionada()" {
start
:codigo = cmbTipoCodigo.getValue();
if (codigo is null or empty?) then (yes)
  :return null;
  stop
endif

:dao = new TipoPessoaDAO();
:lista = dao.listarTodos();

repeat
  :Iterar tp in lista;
  if (tp.getCodigo != null and equalsIgnoreCase(codigo.substring(0,1))) then (yes)
    :return tp;
    stop
  endif
repeat while (has next?)

:return null;
stop
}


'=====================================
' Seção 3: montarEnderecoAtual()
'=====================================
partition "montarEnderecoAtual()" {
start
:ok = validarSelecaoEnderecoObrigatoria();
if (ok == false) then (yes)
  :Exception "Dados de endereço incompletos";
  stop
endif

:Build EndPostalVO (estado, cidade, bairro, logradouro, rua, cep);
:Build EnderecoVO (set endPostal, numero, complemento);
:return EnderecoVO;
stop
}


'=====================================
' Seção 4: validarSelecaoEnderecoObrigatoria()
'=====================================
partition "validarSelecaoEnderecoObrigatoria()" {
start
:Check all required:
- estado != null
- cidade != null
- bairro != null
- logradouro != null
- rua not empty
- cep not empty
- numero not empty;

if (all ok?) then (yes)
  :return true;
else
  :return false;
endif
stop
}

@enduml
